---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main class="page">
		<h1 class="title">画像変換 (JPG/PNG → WebP/AVIF)</h1>
		<p class="subtitle">すべてローカルで変換しています。サーバーへの画像データ送信はありません。</p>

		<section class="card">
			<div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="画像をドロップ または クリックして選択">
				<div class="dropzone__inner">
					<div class="dropzone__title">ここに JPG / PNG をドロップ（複数可）</div>
					<div class="dropzone__or">または</div>
					<button id="pickBtn" class="btn" type="button">ファイルを選択</button>
					<input id="fileInput" class="sr-only" type="file" accept="image/jpeg,image/png" multiple />
					<div id="fileMeta" class="meta" aria-live="polite"></div>
				</div>
			</div>

			<div class="controls">
				<label class="field">
					<span class="field__label">変換形式</span>
					<select id="formatSelect" class="select">
						<option value="webp">WebP</option>
						<option value="avif">AVIF</option>
					</select>
				</label>

				<label class="field">
					<span class="field__label">品質: <span id="qualityValue">80</span></span>
					<input id="qualitySlider" type="range" min="0" max="100" value="80" />
				</label>

				<div class="buttons">
					<button id="convertBtn" class="btn primary" type="button" disabled>一括変換</button>
					<button id="downloadAllBtn" class="btn" type="button" disabled>一括ダウンロード（ZIP）</button>
					<button id="clearBtn" class="btn" type="button" disabled>クリア</button>
				</div>
			</div>

			<div class="grid">
				<div class="panel">
					<h2 class="panel__title">ファイル</h2>
					<div id="fileList" class="filelist" aria-live="polite"></div>
				</div>
				<div class="panel">
					<h2 class="panel__title">ステータス</h2>
					<div id="status" class="status" aria-live="polite"></div>
					<div id="error" class="error" role="alert"></div>
				</div>
			</div>
		</section>
	</main>

	<script>
		import '../scripts/converter.ts';
	</script>
</Layout>

<style>
	.page {
		max-width: 980px;
		margin: 0 auto;
		padding: 40px 16px 64px;
	}

	.title {
		margin: 0 0 8px;
		font-size: 32px;
		font-weight: 800;
		letter-spacing: -0.5px;
		color: var(--accent);
	}

	.subtitle {
		margin: 0 0 28px;
		color: var(--text-soft);
		font-size: 14px;
		font-weight: 500;
	}

	.card {
		background: var(--card);
		border: 2px solid var(--border);
		border-radius: 12px;
		padding: 24px;
		box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
	}

	.dropzone {
		border: 2px dashed var(--border-strong);
		border-radius: 8px;
		padding: 24px;
		background: var(--bg);
		cursor: pointer;
		outline: none;
		transition: all 0.2s;
	}

	.dropzone:hover {
		border-color: var(--accent);
		background: #fafafa;
	}

	.dropzone:focus-visible {
		border-color: var(--accent);
		box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
	}

	.dropzone.is-dragover {
		background: #ffffff;
		border-color: var(--accent);
		box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.05);
	}

	.dropzone__inner {
		display: grid;
		gap: 12px;
		justify-items: start;
	}

	.dropzone__title {
		font-weight: 700;
		font-size: 15px;
		color: var(--text);
	}

	.dropzone__or {
		color: var(--muted);
		font-size: 12px;
		font-weight: 500;
	}

	.meta {
		color: var(--muted);
		font-size: 12px;
		font-weight: 500;
	}

	.controls {
		margin-top: 20px;
		padding-top: 20px;
		border-top: 2px solid var(--border);
		display: grid;
		gap: 16px;
	}

	.field {
		display: grid;
		gap: 8px;
	}

	.field__label {
		color: var(--text);
		font-size: 13px;
		font-weight: 700;
	}

	.select,
	input[type="range"] {
		width: 100%;
	}

	.select {
		background: var(--card);
		color: var(--text);
		border: 2px solid var(--border);
		border-radius: 6px;
		padding: 11px 14px;
		font-weight: 600;
		cursor: pointer;
		transition: border-color 0.2s;
	}

	.select:hover {
		border-color: var(--border-strong);
	}

	.select:focus {
		outline: none;
		border-color: var(--accent);
	}

	/* Range Slider */
	input[type="range"] {
		-webkit-appearance: none;
		appearance: none;
		height: 8px;
		background: transparent;
		cursor: pointer;
	}

	input[type="range"]::-webkit-slider-track {
		height: 8px;
		background: var(--border);
		border-radius: 4px;
		border: 2px solid var(--border-strong);
	}

	input[type="range"]::-moz-range-track {
		height: 8px;
		background: var(--border);
		border-radius: 4px;
		border: 2px solid var(--border-strong);
	}

	input[type="range"]::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 24px;
		height: 24px;
		background: var(--accent);
		border: 3px solid var(--card);
		border-radius: 50%;
		box-shadow: 0 0 0 2px var(--accent);
		cursor: pointer;
		transition: transform 0.2s;
	}

	input[type="range"]::-moz-range-thumb {
		width: 24px;
		height: 24px;
		background: var(--accent);
		border: 3px solid var(--card);
		border-radius: 50%;
		box-shadow: 0 0 0 2px var(--accent);
		cursor: pointer;
		transition: transform 0.2s;
	}

	input[type="range"]::-webkit-slider-thumb:hover {
		transform: scale(1.15);
	}

	input[type="range"]::-moz-range-thumb:hover {
		transform: scale(1.15);
	}

	input[type="range"]::-webkit-slider-thumb:active {
		transform: scale(1.05);
	}

	input[type="range"]::-moz-range-thumb:active {
		transform: scale(1.05);
	}

	.buttons {
		display: flex;
		flex-wrap: wrap;
		gap: 12px;
	}

	.btn {
		appearance: none;
		border: 2px solid var(--border);
		background: var(--card);
		color: var(--text);
		padding: 12px 20px;
		border-radius: 6px;
		cursor: pointer;
		font-weight: 700;
		font-size: 14px;
		transition: all 0.2s;
	}

	.btn:hover:not(:disabled) {
		background: var(--bg);
		border-color: var(--border-strong);
	}

	.btn.primary {
		background: var(--accent);
		color: var(--card);
		border-color: var(--accent);
	}

	.btn.primary:hover:not(:disabled) {
		background: var(--accent-soft);
		border-color: var(--accent-soft);
	}

	.btn:disabled {
		opacity: 0.4;
		cursor: not-allowed;
	}

	.grid {
		margin-top: 20px;
		padding-top: 20px;
		border-top: 2px solid var(--border);
		display: grid;
		grid-template-columns: 1fr;
		gap: 16px;
	}

	@media (min-width: 860px) {
		.grid {
			grid-template-columns: 1.3fr 0.7fr;
		}
	}

	.panel {
		border: 2px solid var(--border);
		border-radius: 8px;
		padding: 16px;
		background: var(--bg);
	}

	.panel__title {
		margin: 0 0 14px;
		font-size: 12px;
		color: var(--text);
		font-weight: 800;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.filelist {
		display: grid;
		gap: 10px;
	}

	.file {
		display: grid;
		grid-template-columns: 90px 1fr;
		gap: 12px;
		padding: 12px;
		border: 2px solid var(--border);
		border-radius: 6px;
		background: var(--card);
	}

	.file__thumb {
		width: 90px;
		height: 64px;
		border-radius: 4px;
		border: 2px solid var(--border);
		background: var(--bg);
		display: grid;
		place-items: center;
		overflow: hidden;
	}

	.file__thumb img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}

	.file__meta {
		display: grid;
		gap: 8px;
	}

	.file__name {
		font-weight: 800;
		font-size: 13px;
		line-height: 1.3;
		word-break: break-word;
		color: var(--text);
	}

	.file__sub {
		color: var(--text-soft);
		font-size: 12px;
		font-weight: 500;
		white-space: pre-wrap;
		word-break: break-word;
	}

	.file__actions {
		display: flex;
		flex-wrap: wrap;
		gap: 8px;
	}

	.btn.small {
		padding: 8px 12px;
		border-radius: 6px;
		font-size: 12px;
	}

	.status {
		font-size: 13px;
		color: var(--text-soft);
		font-weight: 500;
		line-height: 1.6;
		white-space: pre-wrap;
		word-break: break-word;
	}

	.error {
		margin-top: 12px;
		padding: 12px;
		font-size: 13px;
		font-weight: 600;
		color: var(--danger);
		white-space: pre-wrap;
		background: rgba(220, 38, 38, 0.05);
		border: 2px solid rgba(220, 38, 38, 0.2);
		border-radius: 6px;
	}

	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border-width: 0;
	}
</style>
